<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MITAI — Genomic Intelligence Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --teal: #00e5cc;
    --teal-dim: #00b09b;
    --dark: #050d12;
    --panel: #0a1a22;
    --panel2: #0d2030;
    --border: #0f3d4a;
    --text: #c8f0ee;
    --text-dim: #5a9090;
    --red: #ff4466;
    --yellow: #ffd700;
    --green: #00ff99;
    --orange: #ff9500;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--dark);
    color: var(--text);
    font-family: 'Exo 2', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Animated grid background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,229,204,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,229,204,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  /* DNA strand animation top bar */
  .dna-bar {
    width: 100%;
    height: 3px;
    background: linear-gradient(90deg, transparent, var(--teal), #00ff99, var(--teal), transparent);
    background-size: 200% 100%;
    animation: dnaFlow 3s linear infinite;
  }
  @keyframes dnaFlow {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  header {
    position: relative;
    z-index: 1;
    padding: 32px 48px 24px;
    display: flex;
    align-items: center;
    gap: 20px;
    border-bottom: 1px solid var(--border);
  }

  .logo-icon {
    width: 48px;
    height: 48px;
    border: 2px solid var(--teal);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Orbitron', monospace;
    font-weight: 900;
    font-size: 14px;
    color: var(--teal);
    animation: pulse 2s ease-in-out infinite;
  }
  @keyframes pulse {
    0%, 100% { box-shadow: 0 0 8px var(--teal); }
    50% { box-shadow: 0 0 24px var(--teal), 0 0 48px rgba(0,229,204,0.3); }
  }

  h1 {
    font-family: 'Orbitron', monospace;
    font-size: 24px;
    font-weight: 900;
    letter-spacing: 4px;
    color: var(--teal);
    text-shadow: 0 0 20px rgba(0,229,204,0.5);
  }

  .subtitle {
    font-size: 11px;
    letter-spacing: 3px;
    color: var(--text-dim);
    text-transform: uppercase;
    margin-top: 4px;
  }

  .disclaimer {
    margin-left: auto;
    font-size: 10px;
    color: var(--text-dim);
    background: rgba(255,68,102,0.1);
    border: 1px solid rgba(255,68,102,0.3);
    border-radius: 4px;
    padding: 8px 12px;
    max-width: 260px;
    line-height: 1.5;
  }

  /* Tabs */
  .tabs {
    position: relative;
    z-index: 1;
    display: flex;
    gap: 0;
    padding: 0 48px;
    border-bottom: 1px solid var(--border);
  }

  .tab {
    padding: 16px 32px;
    font-family: 'Orbitron', monospace;
    font-size: 11px;
    letter-spacing: 2px;
    color: var(--text-dim);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all 0.3s;
    text-transform: uppercase;
  }

  .tab.active {
    color: var(--teal);
    border-bottom-color: var(--teal);
    text-shadow: 0 0 10px rgba(0,229,204,0.5);
  }

  .tab:hover:not(.active) { color: var(--text); }

  /* Main content */
  main {
    position: relative;
    z-index: 1;
    padding: 40px 48px;
    max-width: 1200px;
    margin: 0 auto;
  }

  .panel {
    display: none;
  }
  .panel.active { display: block; }

  .grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
  }

  .card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 28px;
    position: relative;
    overflow: hidden;
  }

  .card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--teal), transparent);
  }

  .card-title {
    font-family: 'Orbitron', monospace;
    font-size: 11px;
    letter-spacing: 3px;
    color: var(--teal);
    text-transform: uppercase;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .card-title::before {
    content: '';
    width: 6px; height: 6px;
    background: var(--teal);
    border-radius: 50%;
    animation: pulse 1.5s ease-in-out infinite;
  }

  textarea {
    width: 100%;
    background: var(--panel2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Share Tech Mono', monospace;
    font-size: 13px;
    padding: 16px;
    resize: vertical;
    outline: none;
    transition: border-color 0.3s;
    line-height: 1.6;
  }

  textarea:focus { border-color: var(--teal); box-shadow: 0 0 12px rgba(0,229,204,0.1); }
  textarea::placeholder { color: var(--text-dim); }

  .sample-btn {
    background: none;
    border: 1px solid var(--border);
    color: var(--text-dim);
    font-family: 'Share Tech Mono', monospace;
    font-size: 11px;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 8px;
    transition: all 0.2s;
  }
  .sample-btn:hover { border-color: var(--teal); color: var(--teal); }

  .btn {
    width: 100%;
    margin-top: 20px;
    padding: 16px;
    background: transparent;
    border: 1px solid var(--teal);
    border-radius: 8px;
    color: var(--teal);
    font-family: 'Orbitron', monospace;
    font-size: 12px;
    letter-spacing: 3px;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
  }

  .btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--teal);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.3s;
    z-index: -1;
  }

  .btn:hover {
    color: var(--dark);
    text-shadow: none;
  }
  .btn:hover::before { transform: scaleX(1); }
  .btn:disabled { opacity: 0.5; cursor: not-allowed; }

  /* Results */
  .results {
    margin-top: 24px;
    display: none;
    animation: fadeIn 0.4s ease;
  }
  .results.show { display: block; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .status-banner {
    padding: 20px 24px;
    border-radius: 10px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border: 1px solid;
  }

  .status-banner.normal { border-color: var(--green); background: rgba(0,255,153,0.05); }
  .status-banner.low { border-color: var(--yellow); background: rgba(255,215,0,0.05); }
  .status-banner.moderate { border-color: var(--orange); background: rgba(255,149,0,0.05); }
  .status-banner.high { border-color: var(--red); background: rgba(255,68,102,0.05); }

  .status-label {
    font-family: 'Orbitron', monospace;
    font-size: 18px;
    font-weight: 700;
  }

  .status-banner.normal .status-label { color: var(--green); }
  .status-banner.low .status-label { color: var(--yellow); }
  .status-banner.moderate .status-label { color: var(--orange); }
  .status-banner.high .status-label { color: var(--red); }

  .risk-score {
    font-family: 'Orbitron', monospace;
    font-size: 32px;
    font-weight: 900;
  }

  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 20px;
  }

  .metric {
    background: var(--panel2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 16px;
    text-align: center;
  }

  .metric-value {
    font-family: 'Orbitron', monospace;
    font-size: 20px;
    color: var(--teal);
    font-weight: 700;
  }

  .metric-label {
    font-size: 10px;
    letter-spacing: 2px;
    color: var(--text-dim);
    text-transform: uppercase;
    margin-top: 6px;
  }

  .info-row {
    background: var(--panel2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 16px 20px;
    margin-bottom: 12px;
  }

  .info-label {
    font-size: 10px;
    letter-spacing: 2px;
    color: var(--text-dim);
    text-transform: uppercase;
    margin-bottom: 6px;
  }

  .info-value {
    font-family: 'Share Tech Mono', monospace;
    font-size: 13px;
    color: var(--text);
  }

  .mutation-list {
    list-style: none;
  }

  .mutation-list li {
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
    font-family: 'Share Tech Mono', monospace;
    font-size: 12px;
    display: flex;
    align-items: flex-start;
    gap: 10px;
  }

  .mutation-list li:last-child { border-bottom: none; }

  .mutation-list li.warn::before {
    content: '⚠';
    color: var(--orange);
    flex-shrink: 0;
  }

  .mutation-list li.ok::before {
    content: '✓';
    color: var(--green);
    flex-shrink: 0;
  }

  /* Progress bar for compatibility */
  .compat-bar-wrap {
    background: var(--panel2);
    border-radius: 999px;
    height: 12px;
    overflow: hidden;
    margin: 12px 0;
    border: 1px solid var(--border);
  }

  .compat-bar {
    height: 100%;
    border-radius: 999px;
    transition: width 1s ease;
    background: linear-gradient(90deg, var(--teal), var(--green));
  }

  /* Loader */
  .loader {
    display: none;
    text-align: center;
    padding: 40px;
  }
  .loader.show { display: block; }

  .dna-loader {
    font-family: 'Share Tech Mono', monospace;
    font-size: 20px;
    color: var(--teal);
    letter-spacing: 8px;
    animation: blink 0.8s steps(1) infinite;
  }

  @keyframes blink { 50% { opacity: 0.2; } }

  .loader-text {
    font-size: 11px;
    color: var(--text-dim);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-top: 12px;
    animation: fadeIn 0.5s ease;
  }

  .error-msg {
    background: rgba(255,68,102,0.1);
    border: 1px solid rgba(255,68,102,0.4);
    border-radius: 8px;
    padding: 16px;
    color: var(--red);
    font-family: 'Share Tech Mono', monospace;
    font-size: 13px;
    margin-top: 16px;
  }

  .base-comp {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .base-pill {
    background: var(--panel2);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 4px 14px;
    font-family: 'Share Tech Mono', monospace;
    font-size: 12px;
  }

  @media (max-width: 768px) {
    header, .tabs, main { padding-left: 20px; padding-right: 20px; }
    .grid-2, .metrics-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<div class="dna-bar"></div>

<header>
  <div class="logo-icon">MIT<br>AI</div>
  <div>
    <h1>MITAI</h1>
    <div class="subtitle">Genomic Intelligence Platform · Proof of Concept</div>
  </div>
  <div class="disclaimer">
    ⚠ Research prototype only. Not for clinical use. All outputs are computational demonstrations, not medical diagnoses.
  </div>
</header>

<div class="tabs">
  <div class="tab active" onclick="switchTab('analyze')">⬡ Sequence Analysis</div>
  <div class="tab" onclick="switchTab('compare')">⬡ Couple Compatibility</div>
</div>

<main>
  <!-- ANALYZE PANEL -->
  <div class="panel active" id="panel-analyze">
    <div class="grid-2">
      <div>
        <div class="card">
          <div class="card-title">Input DNA / RNA Sequence</div>
          <textarea id="seq-input" rows="10" placeholder="Paste your DNA or RNA sequence here...&#10;&#10;Example: ATGCGATCGATCGATCGTAGCTAGCTAGCTAGCTAGCTAGCTAGCT"></textarea>
          <button class="sample-btn" onclick="loadSample('analyze')">Load Sample Sequence</button>
          <button class="btn" onclick="runAnalysis()" id="analyze-btn">▶ ANALYZE SEQUENCE</button>
        </div>

        <div class="loader" id="analyze-loader">
          <div class="dna-loader">A T G C A T G C</div>
          <div class="loader-text">Processing genomic sequence...</div>
        </div>
      </div>

      <div>
        <div class="results" id="analyze-results">
          <!-- Filled dynamically -->
        </div>
      </div>
    </div>
  </div>

  <!-- COMPARE PANEL -->
  <div class="panel" id="panel-compare">
    <div class="grid-2">
      <div>
        <div class="card">
          <div class="card-title">Partner 1 — Sequence</div>
          <textarea id="seq1-input" rows="7" placeholder="Enter first DNA sequence..."></textarea>
          <button class="sample-btn" onclick="loadSample('seq1')">Load Sample</button>
        </div>
        <div class="card" style="margin-top:16px">
          <div class="card-title">Partner 2 — Sequence</div>
          <textarea id="seq2-input" rows="7" placeholder="Enter second DNA sequence..."></textarea>
          <button class="sample-btn" onclick="loadSample('seq2')">Load Sample</button>
          <button class="btn" onclick="runCompare()" id="compare-btn">⬡ ANALYZE COMPATIBILITY</button>
        </div>

        <div class="loader" id="compare-loader">
          <div class="dna-loader">A T G C A T G C</div>
          <div class="loader-text">Comparing genomic profiles...</div>
        </div>
      </div>

      <div>
        <div class="results" id="compare-results">
          <!-- Filled dynamically -->
        </div>
      </div>
    </div>
  </div>
</main>

<script>
const API = 'http://localhost:5000';

const SAMPLES = [
  'ATGCCAGTATGCCAGTATGCCAGTATGCCAGTATGCCAGTATGCCAGTATGCCAGTATGCCAGTATGCCAGTATGCCAGTA',
  'GCGCGCATCGATCGCGCGCATCGATCGCGCGCATCGATCGCGCGCATCGATCGCGCGCATCGATCGCGCGCATCGATCGC',
  'TTAGCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATC',
  'ATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGA',
  'TAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCT',
  'CGTAGCTAGCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGAT',
  'GTATGTATGTATGTATGTATGTATGTATGTATGTATGTATGTATGTATGTATGTATGTATGTATGTATGTATGTATGTAT'
];

let sampleIdx = 0;

function loadSample(target) {
  const s = SAMPLES[sampleIdx % SAMPLES.length];
  sampleIdx++;
  if (target === 'analyze') document.getElementById('seq-input').value = s;
  if (target === 'seq1') document.getElementById('seq1-input').value = s;
  if (target === 'seq2') document.getElementById('seq2-input').value = SAMPLES[(sampleIdx) % SAMPLES.length];
}

function switchTab(tab) {
  document.querySelectorAll('.tab').forEach((t,i) => t.classList.toggle('active', (i === 0 && tab==='analyze') || (i===1 && tab==='compare')));
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById('panel-' + tab).classList.add('active');
}

function getStatusClass(status) {
  if (!status) return 'normal';
  const s = status.toLowerCase();
  if (s.includes('high')) return 'high';
  if (s.includes('moderate')) return 'moderate';
  if (s.includes('low')) return 'low';
  return 'normal';
}

function renderAnalysis(data) {
  if (data.error) {
    return `<div class="error-msg">⚠ ${data.error}</div>`;
  }

  const sc = getStatusClass(data.status);
  const mutations = data.mutations_detected || [];
  const allNormal = mutations.length === 1 && mutations[0].includes('No significant');

  const baseComp = Object.entries(data.base_composition || {})
    .map(([b,p]) => `<span class="base-pill">${b}: ${p}%</span>`).join('');

  const mutList = mutations.map(m => {
    const isOk = m.includes('No significant');
    return `<li class="${isOk ? 'ok' : 'warn'}">${m}</li>`;
  }).join('');

  return `
    <div class="status-banner ${sc}">
      <div>
        <div style="font-size:11px;letter-spacing:2px;color:var(--text-dim);margin-bottom:4px">GENOMIC STATUS</div>
        <div class="status-label">${data.status || 'Unknown'}</div>
      </div>
      <div style="text-align:right">
        <div style="font-size:11px;letter-spacing:2px;color:var(--text-dim);margin-bottom:4px">RISK SCORE</div>
        <div class="risk-score" style="color:${sc==='high'?'var(--red)':sc==='moderate'?'var(--orange)':sc==='low'?'var(--yellow)':'var(--green)'}">${data.risk_score}</div>
      </div>
    </div>

    <div class="metrics-grid">
      <div class="metric">
        <div class="metric-value">${data.sequence_length || 0}</div>
        <div class="metric-label">Bases</div>
      </div>
      <div class="metric">
        <div class="metric-value">${data.gc_content || 0}%</div>
        <div class="metric-label">GC Content</div>
      </div>
      <div class="metric">
        <div class="metric-value">${data.confidence || 0}%</div>
        <div class="metric-label">Confidence</div>
      </div>
    </div>

    <div class="info-row">
      <div class="info-label">Predicted Gene Family</div>
      <div class="info-value">${data.predicted_gene_family || 'Unknown'}</div>
    </div>

    <div class="info-row">
      <div class="info-label">Disorder Flag</div>
      <div class="info-value" style="color:${sc==='normal'?'var(--green)':'var(--orange)'}">${data.disorder_flag || '—'}</div>
    </div>

    <div class="info-row">
      <div class="info-label">Base Composition</div>
      <div class="base-comp">${baseComp}</div>
    </div>

    <div class="info-row">
      <div class="info-label">Mutation / Variation Patterns</div>
      <ul class="mutation-list">${mutList}</ul>
    </div>
  `;
}

function renderCompare(data) {
  if (data.error) {
    return `<div class="error-msg">⚠ ${data.error}</div>`;
  }

  const score = data.compatibility_score || 0;
  const barColor = score > 70 ? 'linear-gradient(90deg,var(--teal),var(--green))' : score > 40 ? 'linear-gradient(90deg,var(--orange),var(--yellow))' : 'linear-gradient(90deg,var(--red),var(--orange))';

  return `
    <div class="status-banner ${score > 70 ? 'normal' : score > 40 ? 'moderate' : 'high'}">
      <div>
        <div style="font-size:11px;letter-spacing:2px;color:var(--text-dim);margin-bottom:4px">COMPATIBILITY</div>
        <div class="status-label" style="font-size:14px">${score > 70 ? 'COMPATIBLE' : score > 40 ? 'CAUTION' : 'HIGH RISK'}</div>
      </div>
      <div style="text-align:right">
        <div class="risk-score" style="color:${score > 70 ? 'var(--green)' : score > 40 ? 'var(--orange)' : 'var(--red)'}">${score}</div>
        <div style="font-size:10px;color:var(--text-dim)">/100</div>
      </div>
    </div>

    <div class="card" style="margin-bottom:16px">
      <div class="card-title">Genomic Similarity</div>
      <div style="font-family:'Share Tech Mono';font-size:28px;color:var(--teal)">${data.kmer_similarity}%</div>
      <div class="compat-bar-wrap">
        <div class="compat-bar" style="width:${data.kmer_similarity}%;background:${barColor}"></div>
      </div>
      <div style="font-size:11px;color:var(--text-dim)">${data.shared_kmers} shared k-mer motifs detected</div>
    </div>

    <div class="metrics-grid">
      <div class="metric">
        <div class="metric-value" style="font-size:14px">${data.sequence_1_status || '—'}</div>
        <div class="metric-label">Partner 1</div>
      </div>
      <div class="metric">
        <div class="metric-value" style="font-size:14px">${data.sequence_2_status || '—'}</div>
        <div class="metric-label">Partner 2</div>
      </div>
      <div class="metric">
        <div class="metric-value">${data.combined_risk_score || 0}</div>
        <div class="metric-label">Combined Risk</div>
      </div>
    </div>

    <div class="info-row">
      <div class="info-label">Partner 1 Gene Family</div>
      <div class="info-value">${data.sequence_1_gene_family || '—'}</div>
    </div>

    <div class="info-row">
      <div class="info-label">Partner 2 Gene Family</div>
      <div class="info-value">${data.sequence_2_gene_family || '—'}</div>
    </div>

    <div class="info-row" style="border-color:${score > 70 ? 'rgba(0,255,153,0.3)' : 'rgba(255,68,102,0.3)'}">
      <div class="info-label">Compatibility Assessment</div>
      <div class="info-value" style="color:${score > 70 ? 'var(--green)' : score > 40 ? 'var(--orange)' : 'var(--red)'}">${data.compatibility_result || '—'}</div>
    </div>

    <div class="info-row">
      <div class="info-label">Recommendation</div>
      <div class="info-value" style="color:var(--text-dim)">${data.recommendation || '—'}</div>
    </div>
  `;
}

async function runAnalysis() {
  const seq = document.getElementById('seq-input').value.trim();
  if (!seq) { alert('Please enter a sequence.'); return; }

  const btn = document.getElementById('analyze-btn');
  const loader = document.getElementById('analyze-loader');
  const results = document.getElementById('analyze-results');

  btn.disabled = true;
  loader.classList.add('show');
  results.classList.remove('show');

  try {
    const res = await fetch(`${API}/analyze`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({sequence: seq})
    });
    const data = await res.json();
    results.innerHTML = renderAnalysis(data);
    results.classList.add('show');
  } catch(e) {
    results.innerHTML = `<div class="error-msg">⚠ Cannot connect to server. Make sure Flask is running on port 5000.<br><br>${e.message}</div>`;
    results.classList.add('show');
  } finally {
    btn.disabled = false;
    loader.classList.remove('show');
  }
}

async function runCompare() {
  const seq1 = document.getElementById('seq1-input').value.trim();
  const seq2 = document.getElementById('seq2-input').value.trim();
  if (!seq1 || !seq2) { alert('Please enter both sequences.'); return; }

  const btn = document.getElementById('compare-btn');
  const loader = document.getElementById('compare-loader');
  const results = document.getElementById('compare-results');

  btn.disabled = true;
  loader.classList.add('show');
  results.classList.remove('show');

  try {
    const res = await fetch(`${API}/compare`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({sequence1: seq1, sequence2: seq2})
    });
    const data = await res.json();
    results.innerHTML = renderCompare(data);
    results.classList.add('show');
  } catch(e) {
    results.innerHTML = `<div class="error-msg">⚠ Cannot connect to server. Make sure Flask is running on port 5000.<br><br>${e.message}</div>`;
    results.classList.add('show');
  } finally {
    btn.disabled = false;
    loader.classList.remove('show');
  }
}

// Allow Enter key submission
document.addEventListener('keydown', (e) => {
  if (e.ctrlKey && e.key === 'Enter') {
    if (document.getElementById('panel-analyze').classList.contains('active')) runAnalysis();
    else runCompare();
  }
});
</script>
</body>
</html>